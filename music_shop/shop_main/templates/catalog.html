{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'product_card.css' %}" />
<link rel="stylesheet" href="{% static 'catalog.css' %}" />

<div class="catalog-container">
    <div class="sidebar">
        <form method="get" id="filter-form">
            <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
            
            <div class="search-box">
                <label for="search">–ü–æ–∏—Å–∫</label>
                <input type="text" name="search" id="search" 
                       value="{{ current_search }}" 
                       placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å">
            </div>
            
            <div class="filter-group">
                <label for="genre">–ñ–∞–Ω—Ä</label>
                <select name="genre" id="genre">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    {% for genre in genres %}
                        <option value="{{ genre.genre_name }}" 
                                {% if current_genre == genre.genre_name %}selected{% endif %}>
                            {{ genre.get_genre_name_display }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="artist">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</label>
                <select name="artist" id="artist">
                    <option value="">–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</option>
                    {% for artist in artists %}
                        <option value="{{ artist.id }}" 
                                {% if current_artist == artist.id|stringformat:"s" %}selected{% endif %}>
                            {{ artist.artist_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label>–¶–µ–Ω–∞ (‚ÇΩ)</label>
                <div class="price-range">
                    <input type="number" name="min_price" id="min_price" 
                           value="{{ current_min_price }}" 
                           placeholder="–û—Ç" min="0">
                    <input type="number" name="max_price" id="max_price" 
                           value="{{ current_max_price }}" 
                           placeholder="–î–æ" min="0">
                </div>
            </div>
            
            <div class="sort-box">
                <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                <select name="sort" id="sort">
                    <option value="created_at" {% if current_sort == 'created_at' %}selected{% endif %}>–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                    <option value="-created_at" {% if current_sort == '-created_at' %}selected{% endif %}>–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (—É–±—ã–≤.)</option>
                    <option value="price" {% if current_sort == 'price' %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ (–≤–æ–∑—Ä.)</option>
                    <option value="-price" {% if current_sort == '-price' %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ (—É–±—ã–≤.)</option>
                    <option value="product_name" {% if current_sort == 'product_name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                    <option value="-product_name" {% if current_sort == '-product_name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                </select>
            </div>
            
            <div class="filter-buttons">
                <button type="submit" class="btn-filter">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <button type="button" class="btn-clear" onclick="clearFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </form>
    </div>
    
    <div class="catalog-content">
        <div class="catalog-header">
            <h1 class="catalog-title">–ö–∞—Ç–∞–ª–æ–≥</h1>
            <div class="results-count">
                –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products|length }}
            </div>
        </div>
        
        {% if products %}
            <div class="products-grid">
                {% for product in products %}
                    <div class="product-card">
                        <div class="product-image">
                            {% if product.images.first %}
                                <img src="{{ product.images.first.image.url }}" alt="{{ product.product_name }}">
                            {% else %}
                                <div class="vinyl-placeholder">üéµ</div>
                            {% endif %}
                        </div>
                        <h3>{{ product.product_name }}</h3>
                        <p class="artist">{{ product.artist.artist_name }}</p>
                        <p class="genre">{{ product.genre.get_genre_name_display }}</p>
                        <p class="price">{{ product.price }} ‚ÇΩ</p>
                        <button class="add-to-cart">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-products">
                <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
function clearFilters() {
    document.getElementById('filter-form').reset();
    window.location.href = '{% url "catalog" %}';
}
</script>
{% endblock content %}
